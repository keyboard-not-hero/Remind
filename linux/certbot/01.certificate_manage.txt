基于CentOS 7系统，Nginx Web服务器软件
log路径:
/var/log/letsencrypt


安装证书
1.安装python3及其他依赖文件
yum install python3 augeas-libs

2.创建虚拟环境
python3 -m venv /opt/certbot

/opt/certbot/bin/pip install --upgrade pip

3.安装certbot
/opt/certbot/bin/pip install certbot certbot-nginx

4.创建certbot的软链接
ln -s /opt/certbot/bin/certbot /usr/bin/certbot

5.安装证书
certbot --nginx

6.自动更新证书
echo "0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random()*3600)' && certbot renew -q" | tee -a /etc/crontab > /dev/null

7.校验certbot是否生效
校验地址：https://www.ssllabs.com/ssltest/



其他证书操作
查看证书
certbot certificates

模拟更新证书
certbot renew --dry-run

更新所有证书
certbot renew

强制更新证书(不管证书是否即将过期)
certbot renew --force-renewal 

更新指定证书
certbot renew --cert-name <cert_name>

撤销指定证书
certbot revoke -cert-name <cert_name>

删除与证书有关的内容
certbot delete
** 切记需删除nginx配置文件中与certbot有关的内容("#manage by certbot"后缀内容)

静默安装(常用于cron排程)
certbot --quiet renew


certbot更新问题
1.'ascii' codec can't decode byte 0xe5
问题说明：nginx/apache配置文件中包含ascii以外的文本(如，中文)，删除中文说明
解决步骤：
i.查找包含报错文本的文件
grep -r -P '[^\x00-\x7f]' /etc/apache2 /etc/letsencrypt /etc/nginx
ii.删除报错文本


最后编辑时间: 2021-10-12


引用:
[1] https://blog.longwin.com.tw/2019/01/letsencrypt-ascii-codec-decode-fixed-2019/
[2] https://certbot.eff.org/instructions
