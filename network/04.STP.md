STP(Spanning Tree Protocol)<br>
通过阻塞接口, 阻止在物理冗余链路中形成环回链路
<br>
<br>
<br>

STP工作步骤<br>
1.从所有交换机中选择网桥ID最小的, 作为root switch, 该交换机所有接口为designated port, 处于转发状态<br>
** 网桥ID为8 bytes, 前2 bytes为优先级, 可手动设置为4096的倍数N, 结果为N+vlan_num, N默认设置为32768; 后6 bytes为mac地址
<br>
<br>

2.从每一个非root switch中, 选取该交换机与root switch含最少链路成本的路径, 其对应的接口为root port; 如果多条链路成本相同, 则比较当前交换机的邻接交换机网桥ID, 网桥ID小的, 其邻接接口成为root port<br>
** 链路成本由每紧邻交换机之间的链路带宽决定. 列表如下:<br>
|链路速度    |链路成本    |
|------------|------------|
|10 Mbit/s   |100         |
|100 Mbit/s  |19          |
|1000 Mbit/s |4           |
|10000 Mbit/s|2           |

<br>
<br>

3.其他接口, 如果与root port位于同一链路, 设置为designated port<br>

如果有一条链路两端都没有设置接口类型, 则比较两端, 到root switch的链路成本最少的设备, 该设备的端口设置为designated port; 如果链路成本相同, 网桥ID最小一端的接口设置为designated port<br>

最后, 全部接口设置为alternative port<br>

** root port与designated port为转发状态; alternative port为关闭状态
<br>
<br>
<br>

查看STP的汇总信息
```
# show spanning-tree summary
Switch is in pvst mode
Root bridge for: none
EtherChannel misconfig guard            is enabled
Extended system ID                      is enabled
Portfast Default                        is disabled
Portfast Edge BPDU Guard Default        is disabled
Portfast Edge BPDU Filter Default       is disabled
Loopguard Default                       is disabled
Platform PVST Simulation                is enabled
PVST Simulation Default                 is enabled but inactive in pvst mode
Bridge Assurance                        is enabled but inactive in pvst mode
Pathcost method used                    is short
UplinkFast                              is disabled
BackboneFast                            is disabled

Name                   Blocking Listening Learning Forwarding STP Active
---------------------- -------- --------- -------- ---------- ----------
VLAN0001                     0         0        0          4          4
---------------------- -------- --------- -------- ---------- ----------
1 vlan                       0         0        0          4          4
```
<br>
<br>

查看根网桥信息
```
# show spanning-tree root
Vlan                   Root ID          Cost  Time Age Dly  Root Port
---------------- -------------------- ------ ----- --- ---  ----------------
VLAN0001         32769 aabb.cc00.0100       100    2   20  15  Et0/0           
```
<br>
<br>

查看当前交换机的STP信息
```
# show spanning-tree bridge id
VLAN0001         8001.aabb.cc00.0200
```
<br>
<br>

查看STP信息
```
# show spanning-tree
VLAN0001
  Spanning tree enabled protocol ieee
  Root ID    Priority    32769
             Address     aabb.cc00.0100
             Cost        100
             Port        1 (Ethernet0/0)
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec

  Bridge ID  Priority    32769  (priority 32768 sys-id-ext 1)
             Address     aabb.cc00.0200
             Hello Time   2 sec  Max Age 20 sec  Forward Delay 15 sec
             Aging Time 300

Interface           Role Sts Cost      Prio.Nbr Type
------------------- ---- --- --------- -------- --------------------------------
Et0/0               Root FWD 100       128.1    Shr 
Et0/1               Desg FWD 100       128.2    Shr 
Et0/2               Desg FWD 100       128.3    Shr 
Et0/3               Desg FWD 100       128.4    Shr 
```
<br>
<br>

配置当前交换机在指定vlan下的优先级<br>
`(config)# spanning-tree vlan <vlan> priority <priority>`<br>
** 优先级必须配置为4096的倍数
