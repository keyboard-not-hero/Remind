ISO术语:<br>
1.Intermediate System (IS)<br>
A router<br>

2.End System (ES)<br>
A host
<br>
<br>

IS-IS特性:<br>
1.划分Area<br>

2.所有接口都属于一个Area, Area boundary在链路上<br>

3.IS-IS在broadcast链路上选举Designated IS
<br>
<br>

IS-IS路由器类型:<br>
1.L1<br>
区域内所有L1路由器包含一致的L1 LSDB, 邻接路由器都在相同Area内<br>
** L1路由器不接收其他Area的路由, 而是生成一个指向最近L1/L2路由器的默认路由<br>
** L1多播地址: 0180.c200.0014, AllL1ISs<br>

2.L2<br>
所有L2路由器包含一致的L2 LSDB, 邻接路由器可以处于不同Area<br>
** L2多播地址: 0180.c200.0015, AllL2ISs<br>

3.L1/L2<br>
与L1邻接路由器包含一致的L1 LSDB, 与L2邻接路由器包含一致的L2 LSDB, 与L1/L2邻接路由器包含一致的L1 LSDB与L2 LSDB
<br>
<br>

IS-IS DIS选举过程(DIS开启preempt功能):
1.prioirty值最大的选举为DIS<br>

2.mac address值最大的选举为DIS
<br>
<br>


IS-IS配置步骤:<br>
1.配置IS-IS进程<br>
`(config)# router isis [<area_tag>]`<br>
** 当使用多个IS-IS进程时, 配合area_tag使用
<br>

2.配置NET<br>
`(config-router)# net <network_entity_title>`<br>
** network_entity_title格式参考图1
<br>

3.配置L1/L2类型<br>
`(config-router)# is-type {level-1 | level-2-only | level-1-2}`<br>
** 所有路由器默认为level-1-2
<br>

4.接口配置ISIS<br>
`(config-if)# ip router isis [<area_tag>]`
<br>

5.配置优先级(用于DIS选举, 默认为64)<br>
`(config-if)# isis priority <priority>`
<br>

6.设置Remaining Lifetime (即MaxAge, 默认为1200s)/refresh internal(默认为900s)<br>
````
(config-router)# max-lsp-lifetime <seconds>
(config-router)# lsp-refresh-interval <seconds>
````
<br>

7.配置忽略error, 丢弃LSP<br>
`(config-router)# ignore-lsp-errors`<br>
** 在version 12.0之前, 在收到错误的checksum时, 路由器会执行route purge<br>
** 在version 12.0及之后, 默认使用改配置
<br>

8.配置在broadcast中, 发送CSNP(complete SNP, 类似与OSPF的Database description)的周期<br>
`(config)# isis csnp-interval <seconds>`
<br>

9.配置OL bit, 指定时间后取消<br>
`(config-router)# set-overload-bit on-startup <second>`<br>
** 当IS-IS与BGP同时配置时, 为等待BGP收敛, 不将当前路由器作为transit, 设置OL bit
<br>

10.设置OL bit, 直到BGP收敛<br>
`(config-router)# set-overload-bit on-startup wait-for-bgp`<br>
** 相比较于指定second, wait-for-bgp动态等待BGP收敛, 但是当BGP收敛出现问题时, 会导致一致无法取消OL bit
<br>

11.手动设置OL bit<br>
`(config-router)# set-verload-bit`
<br>
<br>

图1 - network_entity_title格式<br>
![image_not_found](pic/network_entity_title.png)<br>
Field解析:<br>
Area ID: 1-13 bytes, 指定当前所处Area<br>

System ID: 6 bytes, 用于指定设备, 具有唯一性. 常使用某个接口的MAC地址<br>

SEL: 1 byte, NSAP Selector, 设置为0x00
<br>
<br>

图2 - network_entity_title模板<br>
![image_not_found](pic/net_example.png)
<br>
<br>

计时器<br>
1)Hello Timer(默认10s)<br>
`(config-if)# isis hello-interval <seconds>`<br>

2)Dold timer(默认为Hello Timer * 3)<br>
`(config-if)# isis hello-multiplier <factor>`
<br>
<br>

显示neighbors<br>
```
# show clns is-neighbors [<interface_id>] [detail]
# show clns neighbors [<interface_id>] [detail]
# show isis neighbors [detail]
```
<br>

显示database<br>
`# show isis database [l1 | l2] [detail | verbose]`
<br>

显示topology<br>
`# show isis topology`
<br>
<br>

图3<br>
![image_not_found](pic/isis_01.png)<br>

示例1(如图3)
```
R1(config)# router isis
R1(config-router)# net 0a.ca01.bed1.0008.00
R1(config-router)# is-type level-1
R1(config-router)# int f0/0
R1(config-if)# ip router isis
R1(config-if)# int f0/1
R1(config-if)# ip router isis

R2(config)# router isis
R2(config-router)# net 0a.ca02.beef.0008.00
R2(config-router)# is-type level-1
R2(config-router)# int f0/0
R2(config-if)# ip router isis
R2(config-if)# int f0/1
R2(config-if)# ip router isis

R3(config)# router isis
R3(config-router)# net 0a.ca03.bf0d.0008.00
R3(config-router)# int f0/0
R3(config-if)# ip router isis
R3(config-if)# int f0/1
R3(config-if)# ip router isis
R3(config-if)# int f1/0
R3(config-if)# ip router isis

R4(config)# router isis
R4(config-router)# net 14.ca04.bf2f.0008.00
R4(config-router)# int f0/0
R4(config-if)# ip router isis
R4(config-if)# int f0/1
R4(config-if)# ip router isis
R4(config-if)# int f1/0
R4(config-if)# ip router isis

R5(config)# router isis
R5(config-router)# net 14.ca05.bf4d.0008.00
R5(config-router)# int f0/0
R5(config-if)# ip router isis
R5(config-if)# int f0/1
R5(config-if)# ip router isis
R5(config-if)# int f1/0
R5(config-if)# ip router isis

R6(config)# router isis
R6(config-router)# net 14.ca06.bf6c.0008.00
R6(config-router)# int f0/0
R6(config-if)# ip router isis
R6(config-if)# int f0/1
R6(config-if)# ip router isis

R7(config)# router isis
R7(config-router)# net 1e.ca07.bf8b.0008.00
R7(config-router)# int f0/0
R7(config-if)# ip router isis
R7(config-if)# int f0/1
R7(config-if)# ip router isis

R8(config)# router isis
R8(config-router)# net 1e.ca08.bfa9.0008.00
R8(config-router)# int f0/0
R8(config-if)# ip router isis



R3# show clns is-neighbors
System Id      Interface   State  Type Priority  Circuit Id         Format
R2             Fa0/1       Up     L1   64        R3.02              Phase V
R1             Fa0/0       Up     L1   64        R3.01              Phase V
R4             Fa1/0       Up     L2   64        R4.01              Phase V

column解析:
System Id - neighbor的system ID
Interface - 与该neighbor连接的当前路由器接口
State - 与neighbor的状态. 只有两种状态: Init/Up
Type - neighbor路由器的Type
Priority - neighbor用于在Broadcast网络中选取DIS的优先级
Circuit ID - 分为两部分, 如下:
    System ID - Broadcast网络中DIS的System ID
    Pseudo node ID - DIS接口的唯一标识符
Format - 通常为Phase V, 代表OSI/DECnet Phase V. 另外一个可能只为DECnet Phase V



R3# show isis database

IS-IS Level-1 Link State Database:
LSPID                 LSP Seq Num  LSP Checksum  LSP Holdtime      ATT/P/OL
R1.00-00              0x00000013   0x021F        1109              0/0/0
R2.00-00              0x0000000D   0x6A86        1113              0/0/0
R2.01-00              0x00000008   0x1EC7        1109              0/0/0
R3.00-00            * 0x0000000F   0xCAD6        1110              1/0/0
R3.01-00            * 0x00000008   0x584D        1067              0/0/0
R3.02-00            * 0x00000008   0x1B6A        1110              0/0/0
IS-IS Level-2 Link State Database:
LSPID                 LSP Seq Num  LSP Checksum  LSP Holdtime      ATT/P/OL
R1.00-00              0x0000000E   0x1ACD        683               0/0/0
R2.00-00              0x0000000B   0xD801        1065              0/0/0
R2.01-00              0x00000007   0xB7B9        0 (1067)          0/0/0
R3.00-00            * 0x0000000D   0x7CDE        1101              0/0/0
R3.01-00            * 0x00000007   0x7DD4        0 (1058)          0/0/0
R3.02-00            * 0x00000007   0x76DA        0 (1101)          0/0/0
R4.00-00              0x0000000B   0x98EF        840               0/0/0
R4.01-00              0x00000007   0xBEEB        833               0/0/0
R5.00-00              0x0000000A   0x882C        830               0/0/0
R5.01-00              0x00000007   0x1F2A        824               0/0/0
R6.00-00              0x0000000B   0x2C41        833               0/0/0
R6.01-00              0x00000007   0x5BAD        830               0/0/0
R6.02-00              0x00000007   0x1ECA        830               0/0/0
R7.00-00              0x00000009   0x7532        810               0/0/0
R7.01-00              0x00000007   0x6148        814               0/0/0
R8.00-00              0x00000009   0x82B6        813               0/0/0
R8.01-00              0x00000007   0x5DCD        813               0/0/0

Field解析:
LSPID - 8 bytes, 代表生成LSP的路由器. 由以下部分组成:
    System ID - 6 bytes, 路由器的System ID
    Pesudo node ID - 1 byte, 如果为非0, 代表路由器在LAN上为DIS
    LSP number - 1 byte, 如果LSP的大小超过MTU时, 进行fragment, 该字段用于区分fragment后的不同segment
** 如果该字段后跟随*, 代表当前路由器
LSP Seq Num - 4 bytes, LSP的序列号
LSP Checksum - 2 bytes, LSP的校验和
LSP Holdtime - LSP的hold timer, 由默认的1200s逐渐减少
ATT/P/OL - 
```
