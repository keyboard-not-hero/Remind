#### Etherchannel
Layer 2 Etherchannel<br>
将两台交换机之间的多个配置相同的物理接口, 聚合为一个逻辑接口, 也称port channel<br>
使用场景: 当链路流量接近饱和, 并且没有提供更高吞吐量的接口<br>
适用于ISO第二层和第三层
<br>
<br>

配置类型:<br>
1.手动配置etherchannel<br>
配置步骤<br>
** 链路两端的channel group可以不同, 但同一端的所有接口, channel group必须一致
```
SW1(config-if)# channel-group <etherchannel> mode on
```
<br>

手动配置实例<br>
```
SW1(config)# int range f0/1-3
SW1(config-if-range)# channel-group 1 mode on

SW2(config)# int range f0/1-3
SW2(config-if-range)# channel-group 1 mode on
```
<br>
<br>

2.使用Dynamic Link Aggregation Protocol配置etherchannel<br>
Dynamic Link Aggregation Protocol协议类型:<br>
1)PAgP(Port Aggregation Protocol)<br>
Cisco专有协议, 最高支持8条链路加入
<br>

PAgP包含的两种模式:
- Desirable<br>
传送和接收PAgP包
<br>

- Auto<br>
接收PAgP包 
<br>
<br>

配置PAgP<br>
`(config-if)# channel-group <etherchannel_id> mode {desirable | auto}`
<br>
<br>

PAgP实例<br>
```
SW1(config)# int range f0/1-3
SW1(config-if-range)# channel-group 1 mode desirable

SW2(config)# int range f0/1-3
SW2(config-if-range)# channel-group 1 mode auto
```
<br>
<br>

2)LACP(Link Aggregation Control Protocol)<br>
IEEE 802.3ad, 最高支持16条链路加入, 其中8条active, 8条备用
<br>

LACP包含的两种模式:
- Active<br>
发送和接收LACP包
<br>

- Passive<br>
接收LACP包
<br>

配置LACP<br>
```
(config-if)# channel-group <etherchannel_id> mode {active | passive}
```
<br>
<br>

** etherchannel需要接口信息一致, 列表如下:
- speed
- duplex
- MTU
- all is Layer 2 switch port/all is Layer 2 routed port
- all in access/all in  trunk
- if trunk: allowed vlan list
- if trunk: native vlan
<br>
<br>

从errdisable恢复<br>
```
(config)# errdisable recovery cause channel-misconfig (STP)
(config)# errdisable recovery interval <seconds>
```
<br>

查看逻辑接口port-channel<br>
`# show interface port-channel <etherchannel_id>`
<br>
<br>

查看etherchannel<br>
`# show etherchannel summary`
<br>
<br>

查看PAgP/LACP邻居<br>
`# show {pagp | lacp} neighbor`
<br>
<br>

发送/接收的PAgP/LACP包统计<br>
```
# show {pagp | lacp} counters
# clear {pagp | lacp} counters
```
<br>

配置etherchannel的负载均衡类别<br>
`(config)# port-channel load-balance <type>`

etherchannel支持的负载均衡类别列表:
|keyword        |description              |layer       |
|---------------|-------------------------|------------|
|src-mac        |source mac address       |2           |
|dst-mac        |destination mac address  |2           |
|src-dst-mac    |source and destination mac address|2  |
|src-ip         |source ip address        |3           |
|dst-ip         |destination ip address   |3           |
|src-dst-ip     |source and destination ip address|3   |
|src-port       |source TCP/UDP port      |4           |
|dst-port       |destination TCP/UDP port |4           |
|src-dst-port   |source and destination TCP/UDP port|4 |

查看负载均衡信息<br>
`# show etherchannel load-balance`
<br>
<br>
<br>
