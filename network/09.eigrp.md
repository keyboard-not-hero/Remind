EIGRP(Enhanced Interior Gateway Routing Protocol)<br>
enhanced distance vector routing protocol
<br>
<br>
<br>

图1<br>
![image_not_found](pic/successor.jpg)<br>
专业术语表
|Term      |Definition                                              |
|----------|--------------------------------------------------------|
|Successor route|到达目标子网最短路径的路由<br> 如: 从R1抵达192.168.1.0/24的successor route为R1 --> R3 --> R5|
|Successor|Successor route中, 起始路由器的下一跳.<br> 如: 从R1抵达192.168.1.0/24的successor为R3|
|Feasible distance(FD)|Successor route的总metric值.<br> 如: R1抵达192.168.1.0/24的FD为30+40+50=120|
|Reported distance(RD)|邻接路由器通告的, 到达指定子网的metric值.<br> 如: R1收到R5到达192.168.1.0/24的RD为50|
|Feasibility condition|路由器接收到的RD必须小于FD|
|Feasible successor|符合Feasibility condition条件的, 作为备用路由.<br> 如: 从R1视角, 50(R1从R5接收的RD) < 120(R1的FD), R1 --> R5为备用路由|

<br>
<br>
<br>

EIGRP packet类型
|Type      |Packet Name   |Function                       |
|----------|--------------|-------------------------------|
|1         |Hello         |发现neighbor和检测neighbor是否失效|
|2         |Request       |从neighbor处获取特定信息           |
|3         |Update        |传送路由和reachability信息          |
|4         |Query         |用于在收敛时发现其他路径       |
|5         |Reply         |响应Query的信息            |

** EIGRP使用RTP(Reliable Transport Protocol)保证按序转发packet, 并且确保接收者收到packet
<br>
<br>
<br>

EIGRP路由器成为neighbor的条件:<br>
1.Metric计算公式一致(包括k值)<br>

2.子网匹配<br>

3.AS number匹配<br>

4.认证参数匹配
<br>
<br>
<br>

EIGRP的Metric计算公式:
$$Metric=256*[(K_1*\frac{10^7}{Bandwidth_{min}}+\frac{K_2*\frac{10^7}{Bandwidth_{min}}}{256-Load}+\frac{K_3*Total\_delay}{10})*\frac{K_5}{K_4+Reliability}]$$
<br>

参数列表:<br>
$Bandwidth_{min}$代表路由上带宽最小的链路带宽, 单位为kbps<br>
$Load$代表接口的负载<br>
$Total\_delay$代表路由上所有链路的累计delay, 单位为$\mu s$<br>
$Reliability$代表接口可靠性<br>

系数:<br>
默认情况下, $K_1$与$K_3$的值为1, $K_2$, $K_4$, $K_5$的值为0
<br>
<br>
<br>

配置EIGRP<br>
1.classic mode<br>
1)配置eigrp process<br>
`(config)# router eigrp <as_number>`<br>

2)配置router id<br>
`(config-router)# eigrp router-id <router_id>`<br>

3)将接口配置eigrp<br>
`(config-router)# network <subnet_id> <wildcard_mask>`
<br>
<br>

2.named mode<br>
1)配置eigrp process<br>
`(config)# router eigrp <process_name>`<br>

2)指定IPv4/IPv4协议簇<br>
`(config-router)# address-family {ipv4 | ipv6} {unicast | vrf <vrf_name>} autonomous-system <as_number>`<br>

3)配置router id<br>
`(config-router-af)# eigrp router-id <router_id>`<br>

4)将接口配置eigrp<br>
`(config-router-af)# network <subnet_id> <wildcard_mask>`
<br>
<br>
<br>

显示配置eigrp的接口<br>
```
# show ip eigrp interfaces [detail] [<interface_id>]
Field                    Description
Interface                运行EIGRP的接口
Peers                    当前接口检测到的EIGRP邻居
Xmit Queue Un/Reliable   发送队列中的Unreliable和Reliable消息数量
Mean SRTT                消息往返的平均时间, 单位为ms
Pacing Time Un/Reliable  Unreliable和Reliable消息的发送间隔时间
```
<br>
<br>
<br>

查看接口的EIGRP邻居<br>
```
# show ip eigrp neighbors [<interface_id>]
Field                    Description
Address                  EIGRP邻居的IP地址
Interface                与该邻居连接的本地接口
Hold                     本地holdtime-上次从邻居接收hello packet的时间间隔
Uptime                   EIGRP邻居关系维持时间
SRTT                     消息往返的平平均时间, 单位为ms
RTO                      等待ACK的时间, 超过该时间后重新发送
Q Cnt                    在队列中等待发送的包(update/query/reply)
Seq Num                  邻居上次发送过来的packet的序列号(hello包不在计算范围)
```
<br>
<br>
<br>

查看不同类型packet记录<br>
`# debug eigrp packets`
<br>
<br>
<br>

![image_not_found](pic/eigrp_topology.jpg)<br>
实例配置
```
R1(config)# int f0/0
R1(config-if)# ip address 172.16.2.1 255.255.255.0
R1(config-if)# no shutdown
R1(config-if)# int f0/1
R1(config-if)# ip address 172.16.1.1 255.255.255.0
R1(config-if)# no shutdown
R1(config)# router eigrp 1
R1(config-router)# network 172.16.1.0 0.0.0.255
R1(config-router)# network 172.16.2.0 0.0.0.255

R2(config)# int f0/0
R2(config-if)# ip address 172.16.2.2 255.255.255.0
R2(config-if)# no shutdown
R2(config-if)# int f0/1
R2(config-if)# ip address 172.16.3.2 255.255.255.0
R2(config-if)# no shutdown
R2(config)# router eigrp 1
R2(config-router)# network 172.16.2.0 0.0.0.255
R2(config-router)# network 172.16.3.0 0.0.0.255

R3(config)# int f0/0
R3(config-if)# ip address 172.16.3.1 255.255.255.0
R3(config-if)# no shutdown
R3(config)# router eigrp 1
R3(config-router)# network 172.16.3.0 0.0.0.255



查看R1的EIGRP拓扑表
R1#show ip eigrp topology [all-links]                                                     
IP-EIGRP Topology Table for AS(1)/ID(172.16.1.1)                               
                                                                               
Codes: P - Passive, A - Active, U - Update, Q - Query, R - Reply,              
       r - reply Status, s - sia Status                                        
                                                                               
P 172.16.1.0/24, 1 successors, FD is 28160                                     
        via Connected, FastEthernet0/1

** 展示拓扑表的successor和feasible successor, 指定all-links则包括不满足feasibility condition的路由
** 状态代码
P - 已计算出最佳路径(ready)
A - 正在计算最佳路径(not ready)



查看R3的EIGRP路由
R3#show ip route
Gateway of last resort is not set

D       172.16.1.0 [90/33280] via 172.16.3.2, 00:08:23, FastEthernet0/0
```
<br>
<br>
<br>

EIGRP特性<br>
1.passive interface<br>
不发送和执行Hello packet, 不与邻接路由器组成neighbor<br>

配置passive interface
```
classic mode:
# 配置单个接口为passive
(config)# router eigrp <as_number>
(config-router)# passive-interface <interface_id>

# 配置AS内所有接口默认为passive, 并且配置单个接口为非passive
(config)# router eigrp <as_number>
(config-router)# passive-interface default
(config-router)# no passive-interface <interface_id>


named mode:
# 配置单个接口为passive
(config)# router eigrp <process_name>
(config-router)# address-family ipv4 unicast autonomous-system <as_number>
(config-router-af)# af-interface <interface_id>
(config-router-af-interface)# passive-interface

# 配置AS内所有接口默认为passive, 并且配置单个接口为非passive
(config)# router eigrp <process_name>
(config-router)# address-family ipv4 unicast autonomous-system <as_number>
(config-router-af)# af-interface default
(config-router-af-interface)# passive-interface
(config-router-af-interface)# exit-af-interface
(config-router-af)# af-interface <interface_id>
(config-router-af-interface)# no passive-interface
```
