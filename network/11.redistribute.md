#### Redistribute
将一个路由协议的路由, 注入到另一个路由协议
<br>
<br>

配置方法:<br>
```
1.进入目标路由协议配置模式
(config)# router <destination_protocol> <destination_protocol_num>

2.将源路由协议的内容进入注入
(config-router)# redistribute  {connected | static | eigrp <as_number> | ospf <process_id> [match {internal | external [1 | 2] | nssa-external [1 | 2]}] [vrf <vrf_instance_name>] | bgp <as_number>} [<destination_protocol_options>] [route-map <route_map_name>]


** destination_protocol_options相对于不同路由协议的可选参数:
1)EIGRP
metric <bandwidth> <delay> <reliability> <load> <mtu>
EIGRP的metric属性
当EIGRP作为目标路由协议时, metric默认为infinite(源路由为connected/static时的情况除外), 所以必须配置该选项


2)OSPF
subnets
是否支持CIDR(Classless Inter-Domain Routing). 提供该参数代表支持CIDR
默认自动携带的参数
参考示例2如下结果:
R6# show run | section router ospf
router ospf 1
 router-id 6.6.6.6
 redistribute eigrp 100 subnets
 redistribute bgp 65200 subnets
 network 192.168.10.0 0.0.0.255 area 0

metric <metric>
指定metric值
当OSPF作为目标路由协议时, metric默认为20

metric-type {1 | 2}
支持LSA Type 5的类型为1/2类
1类redistribute会将当前路由协议域内的metric进行叠加
2类redistribute后不会再当前路由协议域内增加metric的数值

tag <num>
用于标记redistribute route, 用于后续引用
num值范围[0, 4294967295]


3)BGP
metric <metric>
指定metric值
当BGP作为目标路由协议时, 默认metric使用源路由协议的metric值
当BGP作为源路由协议时, 默认不会传播从iBGP peer接收的NLRI

** 当OSPF向BGP注入路由时, 默认不会注入LSA Type 5路由, 需要提供match external [1 | 2]参数. 参考示例6
```
<br>
<br>

图1<br>
![image_not_found](pic/redistribute_01.png)<br>

示例1 - redistribute(如图1)
```
R1(config)# router eigrp 100
R1(config-router)# network 192.168.1.1 0.0.0.0
R1(config-router)# network 10.10.12.0 0.0.0.255

R2(config)# router eigrp 100
R2(config-router)# network 192.168.1.2 0.0.0.0 
R2(config-router)# network 10.10.0.0 0.0.255.255

R3(config)# router eigrp 100
R3(config-router)# network 192.168.1.3 0.0.0.0
R3(config-router)# network 10.10.23.0 0.0.0.255
R3(config)# router ospf 1
R3(config-router)# network 192.168.1.3 0.0.0.0 area 0
R3(config-router)# network 10.10.34.0 0.0.0.255 area 0

R4(config)# router ospf 1
R4(config-router)# network 192.168.1.4 0.0.0.0 area 0
R4(config-router)# network 10.10.0.0 0.0.255.255 area 0

R5(config)# router ospf 1
R5(config-router)# network 192.168.1.5 0.0.0.0 area 0
R5(config-router)# network 10.10.45.0 0.0.0.255 area 0



R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
C        10.10.12.0/24 is directly connected, FastEthernet0/0
L        10.10.12.1/32 is directly connected, FastEthernet0/0
D        10.10.23.0/24 [90/30720] via 10.10.12.2, 00:04:46, FastEthernet0/0
      192.168.1.0/32 is subnetted, 3 subnets
C        192.168.1.1 is directly connected, Loopback0
D        192.168.1.2 [90/156160] via 10.10.12.2, 00:04:54, FastEthernet0/0
D        192.168.1.3 [90/158720] via 10.10.12.2, 00:03:29, FastEthernet0/0


R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O        10.10.34.0/24 [110/2] via 10.10.45.4, 00:01:24, FastEthernet0/0
C        10.10.45.0/24 is directly connected, FastEthernet0/0
L        10.10.45.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 3 subnets
O        192.168.1.3 [110/3] via 10.10.45.4, 00:01:24, FastEthernet0/0
O        192.168.1.4 [110/2] via 10.10.45.4, 00:01:24, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0



R3(config)# router eigrp 100
R3(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500
R3(config-router)# router ospf 1
R3(config-router)# redistribute eigrp 100


R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.10.12.0/24 is directly connected, FastEthernet0/0
L        10.10.12.1/32 is directly connected, FastEthernet0/0
D        10.10.23.0/24 [90/30720] via 10.10.12.2, 00:07:04, FastEthernet0/0
D EX     10.10.34.0/24 [170/33280] via 10.10.12.2, 00:00:41, FastEthernet0/0
D EX     10.10.45.0/24 [170/33280] via 10.10.12.2, 00:00:41, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
C        192.168.1.1 is directly connected, Loopback0
D        192.168.1.2 [90/156160] via 10.10.12.2, 00:07:12, FastEthernet0/0
D        192.168.1.3 [90/158720] via 10.10.12.2, 00:05:47, FastEthernet0/0
D EX     192.168.1.4 [170/33280] via 10.10.12.2, 00:00:41, FastEthernet0/0
D EX     192.168.1.5 [170/33280] via 10.10.12.2, 00:00:41, FastEthernet0/0


R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
O E2     10.10.12.0/24 [110/20] via 10.10.45.4, 00:00:47, FastEthernet0/0
O E2     10.10.23.0/24 [110/20] via 10.10.45.4, 00:00:47, FastEthernet0/0
O        10.10.34.0/24 [110/2] via 10.10.45.4, 00:03:10, FastEthernet0/0
C        10.10.45.0/24 is directly connected, FastEthernet0/0
L        10.10.45.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
O E2     192.168.1.1 [110/20] via 10.10.45.4, 00:00:47, FastEthernet0/0
O E2     192.168.1.2 [110/20] via 10.10.45.4, 00:00:47, FastEthernet0/0
O        192.168.1.3 [110/3] via 10.10.45.4, 00:03:10, FastEthernet0/0
O        192.168.1.4 [110/2] via 10.10.45.4, 00:03:10, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
```
<br>
<br>

图2<br>
![image_not_found](pic/redistribute_02.png)<br>

示例2 - redistribute源类型(如图2)
```
步骤1/2/3/4/5都是基于基础配置
配置BGP
R1(config)# router bgp 65000
R1(config-router)# neighbor 192.168.1.3 remote-as 65000
R1(config-router)# neighbor 192.168.1.3 update-source loopback1
R1(config-router)# neighbor 10.10.30.8 remote-as 65100

R3(config)# router bgp 65000
R3(config-router)# neighbor 192.168.2.1 remote-as 65000           
R3(config-router)# neighbor 192.168.2.1 update-source loopback0

R8(config)# router bgp 65100
R8(config-router)# neighbor 192.168.1.10 remote-as 65100
R8(config-router)# neighbor 192.168.1.10 update-source loopback0
R8(config-router)# neighbor 10.10.30.1 remote-as 65000

R10(config)# router bgp 65100
R10(config-router)# neighbor 192.168.1.8 remote-as 65100
R10(config-router)# neighbor 192.168.1.8 update-source loopback0



配置BGP AS 65000/65100区域的OSPF
R1(config)# router ospf 2
R1(config-router)# network 192.168.2.1 0.0.0.0 area 2
R1(config-router)# network 10.10.10.0 0.0.0.255 area 2

R2(config)# router ospf 2
R2(config-router)# network 192.168.1.2 0.0.0.0 area 2
R2(config-router)# network 10.10.0.0 0.0.255.255 area 2

R3(config)# router ospf 2
R3(config-router)# network 192.168.1.3 0.0.0.0 area 2
R3(config-router)# network 10.10.20.0 0.0.0.255 area 2

R8(config)# router ospf 1
R8(config-router)# network 192.168.1.8 0.0.0.0 area 0
R8(config-router)# network 10.10.40.0 0.0.0.255 area 0

R9(config)# router ospf 1
R9(config-router)# network 192.168.1.9 0.0.0.0 area 0
R9(config-router)# network 10.10.0.0 0.0.255.255 area 0

R10(config)# router ospf 1
R10(config-router)# network 192.168.1.10 0.0.0.0 area 0 
R10(config-router)# network 10.10.50.0 0.0.0.255 area 0



配置OSPF
R1(config)# router ospf 1
R1(config-router)# network 192.168.1.1 0.0.0.0 area 0
R1(config-router)# network 172.16.10.0 0.0.0.255 area 0

R4(config)# router ospf 1
R4(config-router)# network 192.168.1.4 0.0.0.0 area 0
R4(config-router)# network 172.16.0.0 0.0.255.255 area 0

R5(config)# router ospf 1
R5(config-router)# network 192.168.1.5 0.0.0.0 area 0
R5(config-router)# network 172.16.20.0 0.0.0.255 area 0



配置EIGRP
R1(config)# router eigrp 100
R1(config-router)# network 192.168.1.1 0.0.0.0
R1(config-router)# network 192.168.10.0 0.0.0.255

R6(config)# router eigrp 100
R6(config-router)# network 192.168.1.6 0.0.0.0 
R6(config-router)# network 192.168.0.0 0.0.255.255

R7(config)# router eigrp 100
R7(config-router)# network 192.168.1.7 0.0.0.0 
R7(config-router)# network 192.168.20.0 0.0.0.255



R3# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O        10.10.10.0/24 [110/2] via 10.10.20.2, 00:01:27, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/0
L        10.10.20.3/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 2 subnets
O        192.168.1.2 [110/2] via 10.10.20.2, 00:01:27, FastEthernet0/0
C        192.168.1.3 is directly connected, Loopback0
      192.168.2.0/32 is subnetted, 1 subnets
O        192.168.2.1 [110/3] via 10.10.20.2, 00:01:27, FastEthernet0/0


R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:01:14, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 3 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:01:14, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:01:14, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      192.168.1.0/32 is subnetted, 3 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:02:47, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:02:47, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:02:47, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0



1.connected
R1(config)# router bgp 65000
R1(config-router)# redistribute connected
R1(config-router)# router ospf 1
R1(config-router)# redistribute connected
R1(config-router)# router eigrp 100
R1(config-router)# redistribute connected


R3# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 4 subnets, 2 masks
O        10.10.10.0/24 [110/2] via 10.10.20.2, 00:04:09, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/0
L        10.10.20.3/32 is directly connected, FastEthernet0/0
B        10.10.30.0/24 [200/0] via 192.168.2.1, 00:00:41
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 192.168.2.1, 00:00:41
      192.168.1.0/32 is subnetted, 3 subnets
B        192.168.1.1 [200/0] via 192.168.2.1, 00:00:41
O        192.168.1.2 [110/2] via 10.10.20.2, 00:04:09, FastEthernet0/0
C        192.168.1.3 is directly connected, Loopback0
      192.168.2.0/32 is subnetted, 1 subnets
O        192.168.2.1 [110/3] via 10.10.20.2, 00:04:09, FastEthernet0/0
B     192.168.10.0/24 [200/0] via 192.168.2.1, 00:00:41


R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 2 subnets
O E2     10.10.10.0 [110/20] via 172.16.20.4, 00:01:08, FastEthernet0/0
O E2     10.10.30.0 [110/20] via 172.16.20.4, 00:01:08, FastEthernet0/0
      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:04:04, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 3 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:04:04, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:04:04, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
      192.168.2.0/32 is subnetted, 1 subnets
O E2     192.168.2.1 [110/20] via 172.16.20.4, 00:01:08, FastEthernet0/0
O E2  192.168.10.0/24 [110/20] via 172.16.20.4, 00:01:08, FastEthernet0/0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 2 subnets
D EX     10.10.10.0 [170/33280] via 192.168.20.6, 00:01:25, FastEthernet0/0
D EX     10.10.30.0 [170/33280] via 192.168.20.6, 00:01:25, FastEthernet0/0
      172.16.0.0/24 is subnetted, 1 subnets
D EX     172.16.10.0 [170/33280] via 192.168.20.6, 00:01:25, FastEthernet0/0
      192.168.1.0/32 is subnetted, 3 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:04:52, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:04:53, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
      192.168.2.0/32 is subnetted, 1 subnets
D EX     192.168.2.1 [170/158720] via 192.168.20.6, 00:01:25, FastEthernet0/0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:04:53, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0



2.static
R1(config)# ip route 192.168.1.3 255.255.255.255 10.10.10.2
R1(config)# ip route 192.168.1.5 255.255.255.255 172.16.10.4
R1(config)# ip route 192.168.1.7 255.255.255.255 192.168.10.6
R1(config)# router bgp 65000
R1(config-router)# redistribute static
R1(config-router)# router ospf 1
R1(config-router)# redistribute static
R1(config-router)# router eigrp 100
R1(config-router)# redistribute static


R3# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O        10.10.10.0/24 [110/2] via 10.10.20.2, 00:08:48, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/0
L        10.10.20.3/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 2 subnets
O        192.168.1.2 [110/2] via 10.10.20.2, 00:08:48, FastEthernet0/0
C        192.168.1.3 is directly connected, Loopback0
      192.168.2.0/32 is subnetted, 1 subnets
O        192.168.2.1 [110/3] via 10.10.20.2, 00:08:48, FastEthernet0/0


R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:08:06, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:08:06, FastEthernet0/0
O E2     192.168.1.3 [110/20] via 172.16.20.4, 00:00:32, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:08:06, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
O E2     192.168.1.7 [110/20] via 172.16.20.4, 00:00:32, FastEthernet0/0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      192.168.1.0/32 is subnetted, 5 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:08:37, FastEthernet0/0
D EX     192.168.1.3 [170/33280] via 192.168.20.6, 00:00:25, FastEthernet0/0
D EX     192.168.1.5 [170/33280] via 192.168.20.6, 00:00:25, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:08:38, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:08:38, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0



3.EIGRP
R1(config)# router bgp 65000
R1(config-router)# redistribute eigrp 100
R1(config-router)# router ospf 1
R1(config-router)# redistribute eigrp 100


R3# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O        10.10.10.0/24 [110/2] via 10.10.20.2, 00:11:58, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/0
L        10.10.20.3/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
B        192.168.1.1 [200/0] via 192.168.2.1, 00:00:24
O        192.168.1.2 [110/2] via 10.10.20.2, 00:11:58, FastEthernet0/0
C        192.168.1.3 is directly connected, Loopback0
B        192.168.1.6 [200/156160] via 192.168.10.6, 00:00:19
B        192.168.1.7 [200/158720] via 192.168.10.6, 00:00:19
      192.168.2.0/32 is subnetted, 1 subnets
O        192.168.2.1 [110/3] via 10.10.20.2, 00:11:58, FastEthernet0/0
B     192.168.10.0/24 [200/0] via 192.168.2.1, 00:00:24
B     192.168.20.0/24 [200/30720] via 192.168.10.6, 00:00:19


R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:11:16, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:11:16, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:11:16, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
O E2     192.168.1.6 [110/20] via 172.16.20.4, 00:00:13, FastEthernet0/0
O E2     192.168.1.7 [110/20] via 172.16.20.4, 00:00:13, FastEthernet0/0
O E2  192.168.10.0/24 [110/20] via 172.16.20.4, 00:00:13, FastEthernet0/0
O E2  192.168.20.0/24 [110/20] via 172.16.20.4, 00:00:13, FastEthernet0/0



4.OSPF
R1(config)# router bgp 65000
R1(config-router)# redistribute ospf 1
R1(config-router)# router eigrp 100
R1(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500


R3# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 3 subnets, 2 masks
O        10.10.10.0/24 [110/2] via 10.10.20.2, 00:14:33, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/0
L        10.10.20.3/32 is directly connected, FastEthernet0/0
      172.16.0.0/24 is subnetted, 2 subnets
B        172.16.10.0 [200/0] via 192.168.2.1, 00:00:41
B        172.16.20.0 [200/2] via 172.16.10.4, 00:00:36
      192.168.1.0/32 is subnetted, 5 subnets
B        192.168.1.1 [200/0] via 192.168.2.1, 00:00:41
O        192.168.1.2 [110/2] via 10.10.20.2, 00:14:33, FastEthernet0/0
C        192.168.1.3 is directly connected, Loopback0
B        192.168.1.4 [200/2] via 172.16.10.4, 00:00:36
B        192.168.1.5 [200/3] via 172.16.10.4, 00:00:36
      192.168.2.0/32 is subnetted, 1 subnets
O        192.168.2.1 [110/3] via 10.10.20.2, 00:14:33, FastEthernet0/0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/24 is subnetted, 2 subnets
D EX     172.16.10.0 [170/33280] via 192.168.20.6, 00:00:35, FastEthernet0/0
D EX     172.16.20.0 [170/33280] via 192.168.20.6, 00:00:35, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:14:28, FastEthernet0/0
D EX     192.168.1.4 [170/33280] via 192.168.20.6, 00:00:35, FastEthernet0/0
D EX     192.168.1.5 [170/33280] via 192.168.20.6, 00:00:35, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:14:29, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:14:29, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0



5.BGP
R1(config)# router bgp 65000
R1(config-router)# network 192.168.2.1 mask 255.255.255.255
R3(config)# int loopback1      
R3(config-if)# ip add 192.168.2.3 255.255.255.255
R3(config-if)# router bgp 65000
R3(config-router)# network 192.168.2.3 mask 255.255.255.255
R8(config)# router bgp 65100
R8(config-router)# network 192.168.1.8 mask 255.255.255.255
R10(config)# router bgp 65100
R10(config-router)# network 192.168.1.10 mask 255.255.255.255

R1(config)# router ospf 1
R1(config-router)# redistribute bgp 65000
R1(config-router)# router eigrp 100
R1(config-router)# redistribute bgp 65000 metric 100000 10 255 1 1500


R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:07:15, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:07:15, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:07:15, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
O E2     192.168.1.8 [110/1] via 172.16.20.4, 00:00:37, FastEthernet0/0
O E2     192.168.1.10 [110/1] via 172.16.20.4, 00:00:37, FastEthernet0/0
      192.168.2.0/32 is subnetted, 1 subnets
O E2     192.168.2.1 [110/1] via 172.16.20.4, 00:00:37, FastEthernet0/0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      192.168.1.0/32 is subnetted, 5 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:08:04, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:08:04, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
D EX     192.168.1.8 [170/33280] via 192.168.20.6, 00:00:31, FastEthernet0/0
D EX     192.168.1.10 [170/33280] via 192.168.20.6, 00:00:31, FastEthernet0/0
      192.168.2.0/32 is subnetted, 1 subnets
D EX     192.168.2.1 [170/33280] via 192.168.20.6, 00:00:31, FastEthernet0/0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:08:04, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0

由R5/R7结果显示, 192.168.2.3/24没有在路由表中, 是因为BGP作为redistribute源路由协议时, 默认不传播从iBGP peer接收的NLRI
如果需要redistribute从iBGP peer接收的NLRI, 使用如下指令:
(config)# router bgp <as_number>
(config-router)# bgp redistribute-internal


R1(config)# router bgp 65000
R1(config-router)# bgp redistribute-internal


R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:26:02, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 5 subnets
O        192.168.1.1 [110/3] via 172.16.20.4, 00:26:02, FastEthernet0/0
O        192.168.1.4 [110/2] via 172.16.20.4, 00:26:02, FastEthernet0/0
C        192.168.1.5 is directly connected, Loopback0
O E2     192.168.1.8 [110/1] via 172.16.20.4, 00:08:08, FastEthernet0/0
O E2     192.168.1.10 [110/1] via 172.16.20.4, 00:08:08, FastEthernet0/0
      192.168.2.0/32 is subnetted, 2 subnets
O E2     192.168.2.1 [110/1] via 172.16.20.4, 00:08:08, FastEthernet0/0
O E2     192.168.2.3 [110/1] via 172.16.20.4, 00:01:30, FastEthernet0/0


R7# show ip route | begin Gateway
Gateway of last resort is not set

      192.168.1.0/32 is subnetted, 5 subnets
D        192.168.1.1 [90/158720] via 192.168.20.6, 00:27:13, FastEthernet0/0
D        192.168.1.6 [90/156160] via 192.168.20.6, 00:27:13, FastEthernet0/0
C        192.168.1.7 is directly connected, Loopback0
D EX     192.168.1.8 [170/33280] via 192.168.20.6, 00:08:24, FastEthernet0/0
D EX     192.168.1.10 [170/33280] via 192.168.20.6, 00:08:24, FastEthernet0/0
      192.168.2.0/32 is subnetted, 2 subnets
D EX     192.168.2.1 [170/33280] via 192.168.20.6, 00:08:24, FastEthernet0/0
D EX     192.168.2.3 [170/33280] via 192.168.20.6, 00:02:02, FastEthernet0/0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:27:13, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0
```
<br>
<br>





图3<br>
![image_not_found](pic/redistribute_03.png)<br>

图4<br>
![image_not_found](pic/redistribute_04.png)<br>

##### redistribute的特性
1.同一个路由器上, 三个或以上路由协议进行redistribute时, 不进行传递<br>
示例3(如图3)
```
配置BGP
R1(config)# router bgp 65100
R1(config-router)# bgp router-id 1.1.1.1
R1(config-router)# neighbor 10.10.10.2 remote-as 65100
R1(config-router)# neighbor 10.10.20.3 remote-as 65100
R1(config-router)# redistribute connected

R2(config)# router bgp 65100
R2(config-router)# bgp router-id 2.2.2.2
R2(config-router)# neighbor 10.10.10.1 remote-as 65100
R2(config-router)# neighbor 10.10.30.3 remote-as 65100
R2(config-router)# redistribute connected

R3(config)# router bgp 65100
R3(config-router)# bgp router-id 3.3.3.3
R3(config-router)# neighbor 10.10.20.1 remote-as 65100
R3(config-router)# neighbor 10.10.30.2 remote-as 65100
R3(config-router)# redistribute connected



配置OSPF
R3(config)# router ospf 1
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 172.16.10.0 0.0.0.255 area 0

R4(config)# router ospf 1
R4(config-router)# router-id 4.4.4.4 
R4(config-router)# network 172.16.0.0 0.0.255.255 area 0

R5(config)# router ospf 1
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 172.16.20.0 0.0.0.255 area 0



配置EIGRP
R3(config)# router eigrp 100
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 192.168.10.0 0.0.0.255

R6(config)# router eigrp 100
R6(config-router)# router-id 6.6.6.6
R6(config-router)# network 192.168.0.0 0.0.255.255

R7(config)# router eigrp 100
R7(config-router)# router-id 7.7.7.7
R7(config-router)# network 192.168.20.0 0.0.0.255



R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.10.10.0/24 is directly connected, FastEthernet0/0
L        10.10.10.1/32 is directly connected, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/1
L        10.10.20.1/32 is directly connected, FastEthernet0/1
B        10.10.30.0/24 [200/0] via 10.10.10.2, 00:11:41
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 10.10.20.3, 00:09:40
B     192.168.10.0/24 [200/0] via 10.10.20.3, 00:09:29

R5# show ip route | begin Gateway
Gateway of last resort is not set

      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:07:05, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0

R7# show ip route | begin Gateway
Gateway of last resort is not set

D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:03:26, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0



1.eigrp --> bgp, ospf --> bgp, bgp --> eigrp, bgp --> ospf
R3(config)# router bgp 65100
R3(config-router)# bgp redistribute-internal
R3(config-router)# redistribute eigrp 100
R3(config-router)# redistribute ospf 1
R3(config-router)# router eigrp 100
R3(config-router)# redistribute bgp 65100 metric 100000 10 255 1 1500
R3(config-router)# router ospf 1
R3(config-router)# redistribute bgp 65100

R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.10.10.0/24 is directly connected, FastEthernet0/0
L        10.10.10.1/32 is directly connected, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/1
L        10.10.20.1/32 is directly connected, FastEthernet0/1
B        10.10.30.0/24 [200/0] via 10.10.10.2, 00:15:42
      172.16.0.0/24 is subnetted, 2 subnets
B        172.16.10.0 [200/0] via 10.10.20.3, 00:13:41
B        172.16.20.0 [200/2] via 172.16.10.4, 00:02:48
B     192.168.10.0/24 [200/0] via 10.10.20.3, 00:13:30
B     192.168.20.0/24 [200/30720] via 192.168.10.6, 00:02:52

R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 1 subnets
O E2     10.10.10.0 [110/1] via 172.16.20.4, 00:00:10, FastEthernet0/0
      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:12:03, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0

R7# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 1 subnets
D EX     10.10.10.0 [170/33280] via 192.168.20.6, 00:00:12, FastEthernet0/0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:08:11, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0

EIGRP AS 100和OSPF Area 0都没有对方的路由



2.EIGRP与OSPF互相redistribute
R3(config)# router eigrp 100
R3(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500
R3(config-router)# router ospf 1
R3(config-router)# redistribute eigrp 100

R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 1 subnets
O E2     10.10.10.0 [110/1] via 172.16.20.4, 00:04:45, FastEthernet0/0
      172.16.0.0/16 is variably subnetted, 3 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.20.4, 00:16:38, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
O E2  192.168.10.0/24 [110/20] via 172.16.20.4, 00:00:12, FastEthernet0/0
O E2  192.168.20.0/24 [110/20] via 172.16.20.4, 00:00:12, FastEthernet0/0

R7# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 1 subnets
D EX     10.10.10.0 [170/33280] via 192.168.20.6, 00:05:27, FastEthernet0/0
      172.16.0.0/24 is subnetted, 2 subnets
D EX     172.16.10.0 [170/33280] via 192.168.20.6, 00:01:03, FastEthernet0/0
D EX     172.16.20.0 [170/33280] via 192.168.20.6, 00:01:03, FastEthernet0/0
D     192.168.10.0/24 [90/30720] via 192.168.20.6, 00:13:26, FastEthernet0/0
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.7/32 is directly connected, FastEthernet0/0
```
<br>

2.序列化redistribute<br>
示例4(如图4)
```
配置EIGRP AS 100
R1(config)# router eigrp 100
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 192.168.1.1 0.0.0.0
R1(config-router)# network 10.12.1.0 0.0.0.255

R2(config)# router eigrp 100
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 10.12.1.0 0.0.0.255


配置EIGRP AS 200
R2(config)# router eigrp 200
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 10.23.1.0 0.0.0.255

R3(config-if)# router eigrp 200
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 10.23.1.0 0.0.0.255
R3(config-router)# network 10.34.1.0 0.0.0.255

R4(config)# router eigrp 200
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 10.34.1.0 0.0.0.255


配置OSPF
R4(config)# router ospf 1
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 10.45.1.0 0.0.0.255 area 0

R5(config)# router ospf 1
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 10.45.1.0 0.0.0.255 area 0
R5(config-router)# network 192.168.5.5 0.0.0.0 area 0


配置BGP
R2(config)# router bgp 65100
R2(config-router)# bgp router-id 2.2.2.2
R2(config-router)# neighbor 10.34.1.4 remote-as 65100
R2(config-router)# redistribute eigrp 200
R2(config-router)# redistribute connected

R4(config)# router bgp 65100
R4(config-router)# bgp router-id 4.4.4.4
R4(config-router)# neighbor 10.23.1.2 remote-as 65100
R4(config-router)# redistribute eigrp 200
R4(config-router)# redistribute connected



redistribute操作
R2(config)# router bgp 65100
R2(config-router)# bgp redistribute-internal 
R2(config-router)# redistribute eigrp 100
R2(config-router)# router eigrp 100
R2(config-router)# redistribute bgp 65100 metric 100000 10 255 1 1500
R2(config-router)# redistribute eigrp 200

R4(config)# router bgp 65100
R4(config-router)# bgp redistribute-internal
R4(config-router)# redistribute ospf 1
R4(config-router)# router ospf 1
R4(config-router)# redistribute bgp 65100
R4(config-router)# redistribute eigrpo 200

查看结果
R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.12.1.0/24 is directly connected, FastEthernet0/0
L        10.12.1.1/32 is directly connected, FastEthernet0/0
D EX     10.23.1.0/24 [170/30720] via 10.12.1.2, 00:02:02, FastEthernet0/0
D EX     10.34.1.0/24 [170/33280] via 10.12.1.2, 00:02:02, FastEthernet0/0
D EX     10.45.1.0/24 [170/30720] via 10.12.1.2, 00:06:09, FastEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
C        192.168.1.1 is directly connected, Loopback0
      192.168.5.0/32 is subnetted, 1 subnets
D EX     192.168.5.5 [170/30720] via 10.12.1.2, 00:02:39, FastEthernet0/0

R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
O E2     10.12.1.0/24 [110/1] via 10.45.1.4, 00:04:37, FastEthernet0/0
O E2     10.23.1.0/24 [110/20] via 10.45.1.4, 00:00:25, FastEthernet0/0
O E2     10.34.1.0/24 [110/20] via 10.45.1.4, 00:00:25, FastEthernet0/0
C        10.45.1.0/24 is directly connected, FastEthernet0/0
L        10.45.1.5/32 is directly connected, FastEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
O E2     192.168.1.1 [110/1] via 10.45.1.4, 00:04:37, FastEthernet0/0
      192.168.5.0/32 is subnetted, 1 subnets
C        192.168.5.5 is directly connected, Loopback0
```
<br>

3.redistribute前提:<br>
1)源路由协议的route必须在路由表(RIB)中<br>

2)目标路由协议需要一个reachable metric
<br>
<br>
<br>

##### Seed Metric
|Protocol|Default Seed Metric|
|---|---|
|EIGRP|1.通过其他EIGRP AS redistribute, 保留EIGRP属性;<br> 2.从其他路由协议redistribute, 值为Infinity|
|OSPF|统一默认为external Type 2类型, metric根据源路由协议的不同, 分为以下情况:<br> 1.通过其他OSPF process redistribute, 保留源OSPF metric(参考示例5);<br> 2.通过BGP redistribute而来, metric为1;<br> 3.通过其他路由协议redistribute, metric为20|
|BGP|Origin属性为incomplete;<br> multi-exit discriminator(MED)设置为源IGP的metric;<br> weight为32768|

<br>

图5<br>
![image_not_found](pic/redistribute_05.png)<br>

示例5(如图5)
```
R1(config)# router ospf 1
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 10.10.0.0 0.0.255.255 area 0

R2(config)# router ospf 1
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 10.10.0.0 0.0.255.255 area 0

R3(config)# router ospf 1 
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 10.10.0.0 0.0.255.255 area 0
R3(config-router)# router ospf 2
R3(config-router)# router-id 3.0.3.0
R3(config-router)# network 172.16.0.0 0.0.255.255 area 1

R4(config)# router ospf 2 
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 172.16.0.0 0.0.255.255 area 1

R5(config)# router ospf 2
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 172.16.0.0 0.0.255.255 area 1

R3(config)# router ospf 1
R3(config-router)# redistribute ospf 2
R3(config-router)# router ospf 2 
R3(config-router)# redistribute ospf 1

R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.10.10.0/24 is directly connected, FastEthernet0/0
L        10.10.10.1/32 is directly connected, FastEthernet0/0
C        10.10.20.0/24 is directly connected, FastEthernet0/1
L        10.10.20.1/32 is directly connected, FastEthernet0/1
O        10.10.30.0/24 [110/2] via 10.10.20.3, 00:06:20, FastEthernet0/1
                       [110/2] via 10.10.10.2, 00:08:00, FastEthernet0/0
      172.16.0.0/24 is subnetted, 3 subnets
O E2     172.16.10.0 [110/1] via 10.10.20.3, 00:01:43, FastEthernet0/1
O E2     172.16.20.0 [110/1] via 10.10.20.3, 00:01:43, FastEthernet0/1
O E2     172.16.30.0 [110/2] via 10.10.20.3, 00:01:43, FastEthernet0/1

R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 3 subnets
O E2     10.10.10.0 [110/2] via 172.16.20.3, 00:01:46, FastEthernet0/0
O E2     10.10.20.0 [110/1] via 172.16.20.3, 00:01:46, FastEthernet0/0
O E2     10.10.30.0 [110/1] via 172.16.20.3, 00:01:46, FastEthernet0/0
      172.16.0.0/16 is variably subnetted, 5 subnets, 2 masks
O        172.16.10.0/24 [110/2] via 172.16.30.4, 00:03:06, FastEthernet0/1
                        [110/2] via 172.16.20.3, 00:02:56, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/0
L        172.16.20.5/32 is directly connected, FastEthernet0/0
C        172.16.30.0/24 is directly connected, FastEthernet0/1
L        172.16.30.5/32 is directly connected, FastEthernet0/1
```
<br>
<br>

图6<br>
![image_not_found](pic/redistribute_06.png)<br>

示例6(如图6)
```
配置EIGRP
R1(config)# router eigrp 100
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 172.16.0.0 0.0.255.255

R2(config)# router eigrp 100
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 172.16.0.0 0.0.255.255

R3(config)# router eigrp 100
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 172.16.0.0 0.0.255.255


配置OSPF
R3(config)# router ospf 1
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 10.10.0.0 0.0.255.255 area 0

R4(config)# router ospf 1
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 10.10.0.0 0.0.255.255 area 0

R5(config)# router ospf 1
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 10.10.0.0 0.0.255.255 area 0

R6(config)# router ospf 1
R6(config-router)# router-id 6.6.6.6
R6(config-router)# network 10.10.0.0 0.0.255.255 area 0


配置BGP
R6(config)# router bgp 65100
R6(config-router)# bgp router-id 6.6.6.6
R6(config-router)# neighbor 192.168.10.7 remote-as 65100
R6(config-router)# neighbor 192.168.20.8 remote-as 65100
R6(config-router)# redistribute connected

R7(config)# router bgp 65100
R7(config-router)# bgp router-id 7.7.7.7
R7(config-router)# neighbor 192.168.10.6 remote-as 65100 
R7(config-router)# neighbor 192.168.30.8 remote-as 65100
R7(config-router)# redistribute connected

R8(config)# router bgp 65100
R8(config-router)# bgp router-id 8.8.8.8
R8(config-router)# neighbor 192.168.20.6 remote-as 65100
R8(config-router)# neighbor 192.168.30.7 remote-as 65100
R8(config-router)# redistribute connected



R3(config)# router eigrp 100
R3(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500
R3(config-router)# router ospf 1
R3(config-router)# redistribute eigrp 100

R6(config)# router bgp 65100
R6(config-router)# bgp redistribute-internal
R6(config-router)# redistribute ospf 1
R6(config-router)# router ospf 1
R6(config-router)# redistribute bgp 65100

R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 4 subnets
D EX     10.10.10.0 [170/30720] via 172.16.20.3, 00:06:18, FastEthernet0/1
D EX     10.10.20.0 [170/30720] via 172.16.20.3, 00:06:18, FastEthernet0/1
D EX     10.10.30.0 [170/30720] via 172.16.20.3, 00:06:18, FastEthernet0/1
D EX     10.10.40.0 [170/30720] via 172.16.20.3, 00:06:18, FastEthernet0/1
      172.16.0.0/16 is variably subnetted, 5 subnets, 2 masks
C        172.16.10.0/24 is directly connected, FastEthernet0/0
L        172.16.10.1/32 is directly connected, FastEthernet0/0
C        172.16.20.0/24 is directly connected, FastEthernet0/1
L        172.16.20.1/32 is directly connected, FastEthernet0/1
D        172.16.30.0/24 [90/30720] via 172.16.20.3, 00:17:11, FastEthernet0/1
                        [90/30720] via 172.16.10.2, 00:17:11, FastEthernet0/0
D EX  192.168.30.0/24 [170/30720] via 172.16.20.3, 00:02:32, FastEthernet0/1

R8# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 4 subnets
B        10.10.10.0 [200/2] via 10.10.30.4, 00:05:41
B        10.10.20.0 [200/2] via 10.10.40.5, 00:05:41
B        10.10.30.0 [200/0] via 192.168.20.6, 00:05:46
B        10.10.40.0 [200/0] via 192.168.20.6, 00:05:46
B     192.168.10.0/24 [200/0] via 192.168.20.6, 00:01:53
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.8/32 is directly connected, FastEthernet0/0
      192.168.30.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.30.0/24 is directly connected, FastEthernet0/1
L        192.168.30.8/32 is directly connected, FastEthernet0/1

结果分析:
EIGRP路由区域的内容没有被redistribute到BGP中
由于OSPF向BGP注入路由时, 默认不注入LSA Type 5类型路由



重新配置OSPF向BGP注入路由, 并配置match参数
R6(config)# router bgp 65100
R6(config-router)# redistribute ospf 1 match internal external 2

R8# show ip route | begin Gateway    
Gateway of last resort is not set

      10.0.0.0/24 is subnetted, 4 subnets
B        10.10.10.0 [200/2] via 10.10.30.4, 00:15:00
B        10.10.20.0 [200/2] via 10.10.40.5, 00:15:00
B        10.10.30.0 [200/0] via 192.168.20.6, 00:15:05
B        10.10.40.0 [200/0] via 192.168.20.6, 00:15:05
      172.16.0.0/24 is subnetted, 3 subnets
B        172.16.10.0 [200/20] via 10.10.30.4, 00:03:34
B        172.16.20.0 [200/20] via 10.10.30.4, 00:03:34
B        172.16.30.0 [200/20] via 10.10.30.4, 00:03:34
B     192.168.10.0/24 [200/0] via 192.168.20.6, 00:11:12
      192.168.20.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.20.0/24 is directly connected, FastEthernet0/0
L        192.168.20.8/32 is directly connected, FastEthernet0/0
      192.168.30.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.30.0/24 is directly connected, FastEthernet0/1
L        192.168.30.8/32 is directly connected, FastEthernet0/1
```
<br>
<br>

##### 修改metric值
```
1) default-metric command
EIGRP:
(config)# router eigrp <as_number>
(config-router)# default-metric <bandwidth> <delay> <realiability> <load> <mtu>

OSPF:
(config)# router ospf <process_id>
(config-router)# default-metric <metric>

BGP:
(config)# router bgp <as_number>
(config-router)# default-metric <metric>


2)metric parameter with redistribute command
EIGRP:
(config)# router eigrp <as_number>
(config-router)# redistribute <src_route_protocol> metric <bandwidth> <delay> <realiability> <load> <mtu>

OSPF:
(config)# router ospf <process_id>
(config-router)# redistribute <src_route_protocol> metric <metric>

BGP:
(config)# router bgp <as_number>
(config-router)# redistribute <src_route_protocol> metric <metric>


3)route-map parameter with redistribute command
EIGRP:
(config)# router eigrp <as_number>
(config-router)# redistribute <src_route_protocol> route-map <route_map_name>

OSPF:
(config)# router ospf <process_id>
(config-router)# redistribute <src_route_protocol> route-map <route_map_name>

BGP:
(config)# router bgp <as_number>
(config-router)# redistribute <src_route_protocol> route-map <route_map_name>


** 当路由符合1/2/3时, 优先级顺序:
3 > 2 > 1
```
<br>

示例7(如图6, 在示例6的配置做修改)
```
R6# show bgp ipv4 unicast | begin Network
     Network          Next Hop            Metric LocPrf Weight Path
 *>  10.10.10.0/24    10.10.30.4               2         32768 ?
 *>  10.10.20.0/24    10.10.40.5               2         32768 ?
 *>  10.10.30.0/24    0.0.0.0                  0         32768 ?
 *>  10.10.40.0/24    0.0.0.0                  0         32768 ?
 *>  172.16.10.0/24   10.10.30.4              20         32768 ?
 *>  172.16.20.0/24   10.10.30.4              20         32768 ?
 *>  172.16.30.0/24   10.10.30.4              20         32768 ?
 *>  192.168.10.0     0.0.0.0                  0         32768 ?
 * i                  192.168.10.7             0    100      0 ?
 *>  192.168.20.0     0.0.0.0                  0         32768 ?
 * i                  192.168.20.8             0    100      0 ?
 * i 192.168.30.0     192.168.20.8             0    100      0 ?
 *>i                  192.168.10.7             0    100      0 ?



R6(config)# ip prefix-list SPECIAL_NET seq 5 permit 10.10.10.0/24
R6(config)# route-map RESET_METRIC permit 10
R6(config-route-map)# match ip address prefix-list SPECIAL_NET
R6(config-route-map)# set metric 10
R6(config-route-map)# set weight 200
R6(config-route-map)# set origin igp
R6(config-route-map)# route-map RESET_METRIC permit 20
R6(config-route-map)# router bgp 65100
R6(config-router)# no redistribute ospf 1 match internal external 2
R6(config-router)# redistribute ospf 1 match internal external 2 route-map RESET_METRIC

R6# show bgp ipv4 unicast | begin Network
     Network          Next Hop            Metric LocPrf Weight Path
 *>  10.10.10.0/24    10.10.30.4              10           200 i
 *>  10.10.20.0/24    10.10.40.5               2         32768 ?
 *>  10.10.30.0/24    0.0.0.0                  0         32768 ?
 *>  10.10.40.0/24    0.0.0.0                  0         32768 ?
 *>  172.16.10.0/24   10.10.30.4              20         32768 ?
 *>  172.16.20.0/24   10.10.30.4              20         32768 ?
 *>  172.16.30.0/24   10.10.30.4              20         32768 ?
 *>  192.168.10.0     0.0.0.0                  0         32768 ?
 * i                  192.168.10.7             0    100      0 ?
 *>  192.168.20.0     0.0.0.0                  0         32768 ?
 * i                  192.168.20.8             0    100      0 ?
 * i 192.168.30.0     192.168.20.8             0    100      0 ?
 *>i                  192.168.10.7             0    100      0 ?
```
<br>
<br>

##### multipoint redistribute故障
当不同路由协议区域包含两个或以上连接点时, 不会出现单点故障, 但容易出现以下问题:<br>
1.Suboptimal routing<br>

2.Routing loops
<br>
<br>

多点故障实例:<br>
1.Suboptimal routing<br>

图8<br>
![image_not_found](pic/redistribute_08.png)<br>

示例8(如图8)
```
配置speed
R1(config)# int g0/1
R1(config-if)# speed 10

R4(config)# int g0/0
R4(config-if)# speed 10

R2(config)# int g0/0
R2(config-if)# speed 100

R3(config)# int g0/1
R3(config-if)# speed 100


配置EIGRP
R1(config)# router eigrp 100
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 172.16.10.0 0.0.0.255

R2(config)# router eigrp 100
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 172.16.20.0 0.0.0.255

R3(config)# router eigrp 100
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 172.16.0.0 0.0.255.255  
R3(config-router)# network 172.20.10.0 0.0.0.255

R5(config)# router eigrp 100
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 172.20.10.0 0.0.0.255
R5(config-router)# network 10.1.1.0 0.0.0.255


配置OSPF
R1(config)# router ospf 1
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 172.16.30.0 0.0.0.255 area 0

R2(config)# router ospf 1
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 172.16.40.0 0.0.0.255 area 0

R4(config)# router ospf 1
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 172.16.0.0 0.0.255.255 area 0
R4(config-router)# network 172.20.20.0 0.0.0.255 area 0

R6(config)# router ospf 1
R6(config-router)# router-id 6.6.6.6
R6(config-router)# network 172.20.20.0 0.0.0.255 area 0
R6(config-router)# network 192.168.2.0 0.0.0.255 area 0


redistribute
R1(config)# router ospf 1
R1(config-router)# redistribute eigrp 100
R1(config-router)# router eigrp 100
R1(config-router)# redistribute ospf 1 metric 1000000 1 255 1 1500

R2(config)# router ospf 1
R2(conifg-router)# redistribute eigrp 100
R2(config-router)# router eigrp 100
R2(config-router)# redistribute ospf 1 metric 1000000 1 255 1 1500



在R3 --> R4方向, 由于忽略了R1与R4之间的链路速度为10 Mbps, 会选择R3 --> R1 --> R4

验证:
R3# traceroute 172.20.20.6
Type escape sequence to abort.
Tracing the route to 172.20.20.6
VRF info: (vrf in name/id, vrf out name/id)
  1 172.16.10.1 2 msec 1 msec 1 msec
  2 172.16.30.4 1 msec 1 msec 1 msec
  3 172.20.20.6 1 msec 2 msec 1 msec
  
重新配置R1的redistribute
R1(config)# router eigrp 100
R1(config-router)# no redistribute ospf 1 metric 1000000 1 255 1 1500
R1(config-router)# redistribute ospf 1 metric 10000 100 255 1 1500

R3# traceroute 172.20.20.6
Type escape sequence to abort.
Tracing the route to 172.20.20.6
VRF info: (vrf in name/id, vrf out name/id)
  1 172.16.20.2 2 msec 1 msec 1 msec
  2 172.16.40.4 2 msec 1 msec 1 msec
  3 172.20.20.6 2 msec 2 msec 1 msec



在R4 --> R3方向, 虽然EIGRP注入OSPF都为metric 20, 并且为external Type 2, 但是OSPF同时会考虑forward metric, R1 -- R4的10 Mbps显然forward metric更高, 所以选择通过R2的路径

验证:
R4# show ip route | include 172.20.10.0
O E2     172.20.10.0/24 [110/20] via 172.16.40.2, 00:06:38, GigabitEthernet0/1
```
<br>
<br>

2.Routing loops<br>

图9<br>
![image_not_found](pic/redistribute_09.png)<br>

示例9(如图9)
```
配置EIGRP
R1(config)# router eigrp 100
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 172.16.10.0 0.0.0.255

R2(config)# router eigrp 100
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 172.16.20.0 0.0.0.255

R3(config)# router eigrp 100
R3(config-router)# router-id 3.3.3.3
R3(config-router)# network 172.16.0.0 0.0.255.255
R3(config-router)# network 172.20.10.0 0.0.0.255

R5(config)# router eigrp 100
R5(config-router)# router-id 5.5.5.5
R5(config-router)# network 172.20.10.0 0.0.0.255


配置OSPF
R1(config)# router ospf 1
R1(config-router)# router-id 1.1.1.1
R1(config-router)# network 172.16.30.0 0.0.0.255 area 0

R2(config)# router ospf 1
R2(config-router)# router-id 2.2.2.2
R2(config-router)# network 172.16.40.0 0.0.0.255 area 0

R4(config)# router ospf 1
R4(config-router)# router-id 4.4.4.4
R4(config-router)# network 172.16.0.0 0.0.255.255 area 0
R4(config-router)# network 172.20.30.0 0.0.0.255 area 0

R7(config)# router ospf 1
R7(config-router)# router-id 7.7.7.7
R7(config-router)# network 172.20.30.0 0.0.0.255 area 0
R7(config-router)# network 192.168.2.0 0.0.0.255 area 0


配置RIP
R5(config)# router rip
R5(config-router)# version 2
R5(config-router)# no auto-summary
R5(config-router)# network 172.20.20.0

R6(config)# router rip
R6(config-router)# version 2
R6(config-router)# no auto-summary
R6(config-router)# network 172.20.20.0
R6(config-router)# network 10.1.1.0



redistribute
R5(config)# router eigrp 100
R5(config-router)# redistribute rip metric 100000 10 255 1 1500
R5(config-router)# router rip
R5(config-router)# redistribute eigrp 100 metric 2

R1(config)# router eigrp 100
R1(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500
R1(config-router)# router ospf 1
R1(config-router)# redistribute eigrp 100

R2(config)# router eigrp 100
R2(config-router)# redistribute ospf 1 metric 100000 10 255 1 1500
R2(config-router)# router ospf 1
R2(config-router)# redistribute eigrp 100



操作步骤:
1.关闭R3

2.配置NTP和debug
R1(config)# ntp master 1
R2(config)# ntp server 172.16.30.1

R1# debug ip eigrp summary
R1# debug ip ospf rib redistribution detail
R1# debug ip ospf spf external
R1# debug ip routing

R2# debug ip eigrp summary
R2# debug ip ospf rib redistribution detail
R2# debug ip ospf spf external
R2# debug ip routing

3.启动R3



输出结果:
1)R1
第一次循环
Mar  1 08:28:44.710: RT: add 10.1.1.0/24 via 172.16.10.3, eigrp metric [170/33280]

Mar  1 08:28:44.710: OSPF-1 REDIS: Notification to redistribute 10.1.1.0/24
Mar  1 08:28:44.710: OSPF-1 REDIS:   Redistribute from process 'EIGRP-IPv4', metric 33280, tag 0x0, attributes 0x1000000, will be advertised

Mar  1 08:28:44.758: OSPF-1 SPF  : Schedule partial SPF type 5, LSID 10.1.1.0, adv_rtr 2.2.2.2 area dummy area
Mar  1 08:28:44.766: RT: add 10.1.1.0/24 via 172.16.30.4, ospf metric [110/20]

Mar  1 08:28:44.826: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 68D4625C, metric 28160, add 1 auto 0

Mar  1 08:28:49.778: RT: del 10.1.1.0 via 172.16.30.4, ospf metric [110/20]
Mar  1 08:28:49.850: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 0, metric 0, add 0 auto 0


第二次循环
Mar  1 08:28:49.850: RT: add 10.1.1.0/24 via 172.16.10.3, eigrp metric [170/33280]

Mar  1 08:28:49.854: OSPF-1 REDIS: Notification to redistribute 10.1.1.0/24
Mar  1 08:28:49.854: OSPF-1 REDIS:   Redistribute from process 'EIGRP-IPv4', metric 33280, tag 0x0, attributes 0x1000000, will be advertised

Mar  1 08:28:54.734: OSPF-1 SPF  : Schedule partial SPF type 5, LSID 10.1.1.0, adv_rtr 2.2.2.2 area dummy area
Mar  1 08:28:54.758: RT: add 10.1.1.0/24 via 172.16.30.4, ospf metric [110/20]

Mar  1 08:28:54.766: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 6802F288, metric 28160, add 1 auto 0

Mar  1 08:28:59.766: RT: del 10.1.1.0 via 172.16.30.4, ospf metric [110/20]
Mar  1 08:28:59.802: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 0, metric 0, add 0 auto 0
...
...



2)R2
第一次循环
Mar  1 08:28:44.708: RT: add 10.1.1.0/24 via 172.16.20.3, eigrp metric [170/33280]

Mar  1 08:28:44.712: OSPF-1 REDIS: Notification to redistribute 10.1.1.0/24
Mar  1 08:28:44.712: OSPF-1 REDIS:   Redistribute from process 'EIGRP-IPv4', metric 33280, tag 0x0, attributes 0x1000000, will be advertised

Mar  1 08:28:44.784: OSPF-1 SPF  : Schedule partial SPF type 5, LSID 10.1.1.0, adv_rtr 1.1.1.1 area dummy area
Mar  1 08:28:44.788: RT: add 10.1.1.0/24 via 172.16.40.4, ospf metric [110/20]

Mar  1 08:28:44.796: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 6802F288, metric 28160, add 1 auto 0

Mar  1 08:28:49.776: RT: del 10.1.1.0 via 172.16.40.4, ospf metric [110/20]
Mar  1 08:28:49.816: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 0, metric 0, add 0 auto 0


第二次循环
Mar  1 08:28:49.820: RT: add 10.1.1.0/24 via 172.16.20.3, eigrp metric [170/33280]

Mar  1 08:28:49.820: OSPF-1 REDIS: Notification to redistribute 10.1.1.0/24
Mar  1 08:28:49.820: OSPF-1 REDIS:   Redistribute from process 'EIGRP-IPv4', metric 33280, tag 0x0, attributes 0x1000000, will be advertised

Mar  1 08:28:54.828: OSPF-1 SPF  : Schedule partial SPF type 5, LSID 10.1.1.0, adv_rtr 1.1.1.1 area dummy area
Mar  1 08:28:54.836: RT: add 10.1.1.0/24 via 172.16.40.4, ospf metric [110/20]

Mar  1 08:28:54.840: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 6802F288, metric 28160, add 1 auto 0

Mar  1 08:28:59.824: RT: del 10.1.1.0 via 172.16.40.4, ospf metric [110/20]
Mar  1 08:28:59.864: EIGRP-IPv4(100): summary_depend: dest 10.1.1.0/24 vec 0, metric 0, add 0 auto 0
...
...



结果分析(参考图9):
从R1的10.1.1.0/24路由情况分析:
1.R1从R3获得10.1.1.0/24路由, 并安装到EIGRP RIB
# show ip routing

2.R1将10.1.1.0/24 redistribute到OSPF Area 0, 并且传播到R2(R2 --> R1亦如此)
# debug ip ospf rib redistribution detail

3.R1接收到R2的10.1.1.0/24路由, 并且110(OSPF的AD值) < 170(external EIGRP的AD值), 因此R1将10.1.1.0/24安装到OSPF RIB
# debug ip ospf spf external

4.R1将10.1.1.0/24 redistribute到EIGRP, 并且在eigrp topology中, 28160(redistribute metric=256 * 110) < 33280(route from R3=256 * 130), 所以redistribute的更优
# debug ip eigrp summary

5.由于EIGRP路由表没有包含该路由, 所以OSPF路由失去redistribute源, OSPF redistribute到EIGRP的28160 metric路由同样没有源, 所以路由表失去10.1.1.0/24;
此时, R1从EIGRP topology表读取由R3获得的路由, 安装到EIGRP(返回到步骤1)
# debug ip routing



解决方案:
1.OSPF LSA Type 5的AD设置为大于170
R1(config)# router ospf 1
R1(config-router)# distance ospf external 180
R1# clear ip ospf process

R2(config)# router ospf 1
R2(config-router)# distance ospf external 180
R2# clear ip ospf process



2.R1/R2使用distribute list, 不允许ospf安装10.1.1.0/24到RIB; 不允许EIGRP安装192.168.2.0/24到RIB
R1(config)# ip prefix-list PREFER_EIGRP seq 10 deny 10.1.1.0/24
R1(config)# ip prefix-list PREFER_EIGRP seq 20 permit 0.0.0.0/0 le 32
R1(config)# router ospf 1
R1(config-rtr)# distribute-list prefix PREFER_EIGRP in

R2(config)# ip prefix-list PREFER_EIGRP seq 10 deny 10.1.1.0/24
R2(config)# ip prefix-list PREFER_EIGRP seq 20 permit 0.0.0.0/0 le 32
R2(config)# router ospf 1
R2(config-rtr)# distribute-list prefix PREFER_EIGRP in
```
<br>
<br>

##### IPv4/IPv4 redistribute的区别
1.IPv4默认将当前路由器加入源路由协议的路由进行redistribute<br>

2.IPv6默认不将当前路由器加入源路由协议的路由进行redistribute, 额外需要redistribute的include-connected完成
<br>
<br>

##### 配置默认AD值
1.配置当前配置器, 指定路由协议的各种类型路由的默认AD值
```
1.OSPF
(config)# router ospf <process_id>
(config-router)# distance ospf {intra-area | inter-area | external} <ad_value>


OSPF示例(如图1)
R3# show ip route ospf | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 6 subnets, 2 masks
O        10.45.1.0/24 [110/2] via 10.34.1.4, 00:01:03, GigabitEthernet0/1
      192.168.5.0/32 is subnetted, 1 subnets
O        192.168.5.5 [110/3] via 10.34.1.4, 00:01:03, GigabitEthernet0/1


R3(config)# router ospf 1
R3(config-router)# distance ospf intra-area 130

R3# show ip route ospf | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 6 subnets, 2 masks
O        10.45.1.0/24 [130/2] via 10.34.1.4, 00:00:21, GigabitEthernet0/1
      192.168.5.0/32 is subnetted, 1 subnets
O        192.168.5.5 [130/3] via 10.34.1.4, 00:00:21, GigabitEthernet0/1



2.EIGRP
(config)# router eigrp <as_number>
(config-router)# distance eigrp <ad_internal> <ad_external>


EIGRP示例(如图1)
R3# show ip route eigrp | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 6 subnets, 2 masks
D        10.12.1.0/24 [90/3072] via 10.23.1.2, 00:47:17, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
D        192.168.1.1 [90/131072] via 10.23.1.2, 00:47:13, GigabitEthernet0/0


R3(config)# router eigrp 100
R3(config-router)# distance eigrp 100 170

R3# show ip route eigrp | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 6 subnets, 2 masks
D        10.12.1.0/24 [100/3072] via 10.23.1.2, 00:00:35, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
D        192.168.1.1 [100/131072] via 10.23.1.2, 00:00:35, GigabitEthernet0/0



3.BGP
(config)# router bgp <as_number>
(config-router)# distance bgp <external_ad> <internal_ad> <local_routes>


BGP示例(如图2)
R6# show ip route bgp | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 11 subnets, 2 masks
B        10.10.10.0/24 [200/30720] via 172.16.10.3, 00:00:45
B        10.10.20.0/24 [200/0] via 172.16.10.3, 00:00:45
B        10.10.30.0/24 [200/0] via 172.16.10.3, 00:00:45
B        10.30.10.0/24 [20/0] via 172.20.10.7, 00:01:05
B        10.30.20.0/24 [20/0] via 172.20.10.7, 00:01:05
B        10.30.30.0/24 [20/30720] via 172.20.10.7, 00:01:05
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 10.20.20.4, 00:00:50


R6(config)# router bgp 65200
R6(config-router)# distance bgp 30 200 200
R6# clear bgp ipv4 unicast *


R6# show ip route bgp | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 11 subnets, 2 masks
B        10.10.10.0/24 [200/30720] via 172.16.10.3, 00:00:06
B        10.10.20.0/24 [200/0] via 172.16.10.3, 00:00:06
B        10.10.30.0/24 [200/0] via 172.16.10.3, 00:00:06
B        10.30.10.0/24 [30/0] via 172.20.10.7, 00:00:10
B        10.30.20.0/24 [30/0] via 172.20.10.7, 00:00:10
B        10.30.30.0/24 [30/30720] via 172.20.10.7, 00:00:10
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 10.20.20.4, 00:00:10
```
<br>
<br>

2.根据条件配置当前路由器的AD值
```
OSPF
(config)# router ospf <process_id>
(config-router)# distance <ad_value> [<source_ip> <source_ip_wildcard> [<acl_number> | <acl_name>]] 

source_ip/source_ip_wildcard
用于指定生成该路由的路由器的RID(Router ID, 如图1, 在R5上的10.12.1.0/24由R3[RID 3.3.3.3]生成, 10.34.1.0/24由R4[RID 4.4.4.4]生成)

acl_number/acl_name
用于筛选指定路由项的ACL (ACL参考文件12.condition_match.md的将ACL应用于路由协议部分)


示例(如图1)
R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
O E2     10.12.1.0/24 [110/20] via 10.45.1.4, 00:00:09, GigabitEthernet0/0
O E2     10.23.1.0/24 [110/20] via 10.45.1.4, 00:00:09, GigabitEthernet0/0
O        10.34.1.0/24 [110/2] via 10.45.1.4, 00:00:09, GigabitEthernet0/0
C        10.45.1.0/24 is directly connected, GigabitEthernet0/0
L        10.45.1.5/32 is directly connected, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
O E2     192.168.1.1 [110/20] via 10.45.1.4, 00:00:09, GigabitEthernet0/0
      192.168.5.0/32 is subnetted, 1 subnets
C        192.168.5.5 is directly connected, Loopback0


R5(config)# ip access-list standard 1
R5(config-std-nacl)# 10 permit 10.12.1.0 0.0.0.255
R5(config-std-nacl)# router ospf 1
R5(config-router)# distance 120 3.3.3.3 0.0.0.0 1

R5# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
O E2     10.12.1.0/24 [120/20] via 10.45.1.4, 00:00:32, GigabitEthernet0/0
O E2     10.23.1.0/24 [110/20] via 10.45.1.4, 00:00:32, GigabitEthernet0/0
O        10.34.1.0/24 [110/2] via 10.45.1.4, 00:00:32, GigabitEthernet0/0
C        10.45.1.0/24 is directly connected, GigabitEthernet0/0
L        10.45.1.5/32 is directly connected, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
O E2     192.168.1.1 [110/20] via 10.45.1.4, 00:00:32, GigabitEthernet0/0
      192.168.5.0/32 is subnetted, 1 subnets
C        192.168.5.5 is directly connected, Loopback0



EIGRP(只作用于internal EIGRP路由)
(config)# router eigrp <as_number>
(config-router)# distance <ad_value> [<source_ip> <source_ip_wildcard> [<acl_number> | <acl_name>]]

source_ip/source_ip_wildcard
用于指定由当前路由器的邻接接口地址传递过来的路由

acl_number/acl_name
用于筛选指定路由项的ACL (ACL参考文件12.condition_match.md的将ACL应用于路由协议部分)


示例(如图1)
R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.12.1.0/24 is directly connected, GigabitEthernet0/0
L        10.12.1.1/32 is directly connected, GigabitEthernet0/0
D        10.23.1.0/24 [90/3072] via 10.12.1.2, 00:58:47, GigabitEthernet0/0
D EX     10.34.1.0/24 [170/3328] via 10.12.1.2, 00:58:46, GigabitEthernet0/0
D EX     10.45.1.0/24 [170/3328] via 10.12.1.2, 00:58:10, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
C        192.168.1.1 is directly connected, Loopback0
      192.168.5.0/32 is subnetted, 1 subnets
D EX     192.168.5.5 [170/3328] via 10.12.1.2, 00:58:00, GigabitEthernet0/0


R1(config)# ip access-list standard 1
R1(config-std-nacl)# 10 permit 10.0.0.0 0.255.255.255
R1(config-std-nacl)# router eigrp 100
R1(config-router)# distance 150 10.12.1.2 0.0.0.0 1

R1# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 5 subnets, 2 masks
C        10.12.1.0/24 is directly connected, GigabitEthernet0/0
L        10.12.1.1/32 is directly connected, GigabitEthernet0/0
D        10.23.1.0/24 [150/3072] via 10.12.1.2, 00:00:04, GigabitEthernet0/0
D EX     10.34.1.0/24 [170/3328] via 10.12.1.2, 00:00:04, GigabitEthernet0/0
D EX     10.45.1.0/24 [170/3328] via 10.12.1.2, 00:00:04, GigabitEthernet0/0
      192.168.1.0/32 is subnetted, 1 subnets
C        192.168.1.1 is directly connected, Loopback0
      192.168.5.0/32 is subnetted, 1 subnets
D EX     192.168.5.5 [170/3328] via 10.12.1.2, 00:00:04, GigabitEthernet0/0



BGP
(config)# router bgp <as_number>
(config-router)# distance <ad_value> [<source_ip> <source_ip_wildcard> [<acl_number> | <acl_name>]]

source_ip/source_ip_wildcard
用于指定由当前路由器的neighbor地址传递过来的路由

acl_number/acl_name
用于筛选指定路由项的ACL (ACL参考文件12.condition_match.md的将ACL应用于路由协议部分)


示例(如图2)
R6# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 11 subnets, 2 masks
B        10.10.10.0/24 [200/30720] via 172.16.10.3, 00:00:14
B        10.10.20.0/24 [200/0] via 172.16.10.3, 00:00:14
B        10.10.30.0/24 [200/0] via 172.16.10.3, 00:00:14
D        10.20.10.0/24 [90/30720] via 10.20.30.5, 00:01:31, FastEthernet0/1
                       [90/30720] via 10.20.20.4, 00:01:31, FastEthernet0/0
C        10.20.20.0/24 is directly connected, FastEthernet0/0
L        10.20.20.6/32 is directly connected, FastEthernet0/0
C        10.20.30.0/24 is directly connected, FastEthernet0/1
L        10.20.30.6/32 is directly connected, FastEthernet0/1
B        10.30.10.0/24 [20/0] via 172.20.10.7, 00:00:22
B        10.30.20.0/24 [20/0] via 172.20.10.7, 00:00:22
B        10.30.30.0/24 [20/30720] via 172.20.10.7, 00:00:22
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 10.20.20.4, 00:00:15
      172.20.0.0/16 is variably subnetted, 2 subnets, 2 masks
C        172.20.10.0/24 is directly connected, FastEthernet1/0
L        172.20.10.6/32 is directly connected, FastEthernet1/0
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.10.0/24 is directly connected, FastEthernet1/1
L        192.168.10.6/32 is directly connected, FastEthernet1/1


R6(config)# ip access-list standard 1
R6(config-std-nacl)# 10 permit 10.0.0.0 0.255.255.255
R6(config-std-nacl)# router bgp 65200
R6(config-router)# distance 145 10.20.20.4 0.0.0.0 1
R6# clear bgp ipv4 unicast *

R6# show ip route | begin Gateway
Gateway of last resort is not set

      10.0.0.0/8 is variably subnetted, 11 subnets, 2 masks
B        10.10.10.0/24 [145/30720] via 172.16.10.3, 00:00:06
B        10.10.20.0/24 [145/0] via 172.16.10.3, 00:00:06
B        10.10.30.0/24 [145/0] via 172.16.10.3, 00:00:06
D        10.20.10.0/24 [90/30720] via 10.20.30.5, 00:06:38, FastEthernet0/1
                       [90/30720] via 10.20.20.4, 00:06:38, FastEthernet0/0
C        10.20.20.0/24 is directly connected, FastEthernet0/0
L        10.20.20.6/32 is directly connected, FastEthernet0/0
C        10.20.30.0/24 is directly connected, FastEthernet0/1
L        10.20.30.6/32 is directly connected, FastEthernet0/1
B        10.30.10.0/24 [20/0] via 172.20.10.7, 00:00:10
B        10.30.20.0/24 [20/0] via 172.20.10.7, 00:00:10
B        10.30.30.0/24 [20/30720] via 172.20.10.7, 00:00:10
      172.16.0.0/24 is subnetted, 1 subnets
B        172.16.10.0 [200/0] via 10.20.20.4, 00:00:10
      172.20.0.0/16 is variably subnetted, 2 subnets, 2 masks
C        172.20.10.0/24 is directly connected, FastEthernet1/0
L        172.20.10.6/32 is directly connected, FastEthernet1/0
      192.168.10.0/24 is variably subnetted, 2 subnets, 2 masks
C        192.168.10.0/24 is directly connected, FastEthernet1/1
L        192.168.10.6/32 is directly connected, FastEthernet1/1
```
<br>
<br>
